.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.32
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "SPSHED 8"
.TH SPSHED 8 "2008-08-18" "GNUspool Release 1" "GNUspool Print Manager"
.SH "NAME"
spshed \- spool scheduler
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBspshed\fR
[ \fIoptions\fR ]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBspshed\fR is the spool scheduler process for the \fBGNUspool\fR spooler
and document management system.
.PP
To start \fBGNUspool\fR, \fBspshed\fR should be started. This should normally
be done using \fIgspl\-start\fR\|(1), which restarts it and passes the appropriate
options. This may be put within the Operating System startup scripts.
.PP
Likewise to halt it, \fIgspl\-stop\fR\|(1) should be invoked. This should be put,
using the \fB\-y\fR option, in any system shutdown
routines.
.PP
If you do need to kill \fBspshed\fR for any reason, first try \fIkill\fR\|(1)
\&\fIwithout\fR any \fB\-9\fR option. This will give \fBspshed\fR the opportunity
to attempt to tidy up any \s-1IPC\s0 facilities before shutting down.
.PP
Information, either in respect of other machines to connect
to, or pre-existing jobs and printers on the current machine, are read
from the files \fIgnuspool.hosts\fR and the spool directory respectively.
.PP
If a networked version of \fBGNUspool\fR is being run, then a \*(L"slave\*(R"
\&\fBspshed\fR process is spawned to monitor and process incoming network
messages. Incoming remotely-submitted jobs and \s-1API\s0 interfaces are
handled via a separate process \fIxtnetserv\fR\|(8), which is also invoked as
appropriate by \fIgspl\-start\fR\|(1).
.PP
Appropriate log messages are written by \fBspshed\fR and other system
processes to a log file, \fIspshed_reps\fR. Be sure to
check this file for any error messages relevant to any problems you
encounter.
.SH "FILES"
.IX Header "FILES"
\&\fIgnuspool.hosts\fR
host names and descriptions
.PP
\&\fIgnuspool.conf\fR
master configuration file
.PP
\&\fIint-config\fR
message file
.PP
\&\fIspshed_jfile\fR
job file
.PP
\&\fIspshed_pfile\fR
printer file
.PP
\&\fIspshed_reps\fR
error log file
.PP
\&\fIspufile0\fR
user data
.PP
\&\fIcharges0\fR
user charges data
.PP
\&\fIspmm_jobi\fR
job memory-mapped hash file
.PP
\&\fIspmm_jobd\fR
job memory-mapped data file
.PP
\&\fIspmm_ptrs\fR
printers memory-mapped file
.PP
\&\fIspmm_xfer\fR
communication buffer memory-mapped file
.SH "ENVIRONMENT"
.IX Header "ENVIRONMENT"
.IP "\s-1SPOOLDIR\s0" 4
.IX Item "SPOOLDIR"
alternative location for spool directory.
.IP "\s-1SPHELPDIR\s0" 4
.IX Item "SPHELPDIR"
alternative location for help file directory.
.IP "\s-1SPROGDIR\s0" 4
.IX Item "SPROGDIR"
alternative location for internal programs directory.
.SH "IPC FACILITIES"
.IX Header "IPC FACILITIES"
An \s-1IPC\s0 message queue, with key \f(CW0x58691000\fR and owned by \f(CW\*(C`spooler\*(C'\fR,
is created by \fBspshed\fR and used to receive messages from user
processes, pass instructions to \fIspd\fR\|(8), and to pass internal messages
from the slave \fBspshed\fR process to the master.
.PP
Two shared memory segments are created to hold details of jobs and
printers. As the shared memory facility provides no facilities for
growth, then additional shared memory segments may be created if the
job and printer lists expand sufficiently and the original ones
deallocated.
.PP
The keys given to the shared memory segments start at \f(CW0x58691002\fR
and ascend upwards to \f(CW0x58691064\fR before wrapping around.
.PP
A further shared memory segment, with key \f(CW0x58692002\fR is created to
hold details of pending jobs before transfer to the main shared memory
segment.
.PP
Versions of \fBspshed\fR may use memory-mapped files rather than shared
memory. The files are held in the spool directory, by default
\&\fI/var/spool/gnuspool\fR, and have the names \fIspmm_jobi\fR, \fIspmm_jobd\fR,
\&\fIspmm_ptrs\fR and \fIspmm_xfer\fR.
.PP
A set of 5 semaphores, with the key \f(CW0x58691001\fR is created to
interlock access to the shared memory segments.
.PP
The presence or absence of these \s-1IPC\s0 facilities is used by \fBspshed\fR
and other programs to determine whether a previous copy of itself is
running. If \fBspshed\fR is abnormally terminated, it will probably be
necessary to delete these \s-1IPC\s0 facilities before \fBspshed\fR can be
restarted.
.PP
When printers are set running, \fBspshed\fR invokes an instance of \fIspd\fR\|(8)
to control each printer. Mail and attention messages are passed to
\&\fIspmdisp\fR\|(8) for processing.
.SH "INTERNET PORTS"
.IX Header "INTERNET PORTS"
\&\fBspshed\fR accepts and sends interconnections from other machines on
\&\s-1TCP\s0 port, passes the contents of spool files on a further \s-1TCP\s0 port, and
undertakes \*(L"probes\*(R" on a \s-1UDP\s0 port.
.PP
The port numbers are set up in the \fI/etc/services\fR file when
\&\fBGNUspool\fR is first installed.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIgspl\-pr\fR\|(1),
\&\fIgspl\-pq\fR\|(1),
\&\fIgspl\-puser\fR\|(1),
\&\fIgspl\-qdel\fR\|(1),
\&\fIgspl\-qchange\fR\|(1),
\&\fIgspl\-qlist\fR\|(1),
\&\fIgspl\-plist\fR\|(1),
\&\fIgspl\-charge\fR\|(1),
\&\fIgspl\-start\fR\|(1),
\&\fIgspl\-stop\fR\|(1),
\&\fIgnuspool.conf\fR\|(5),
\&\fIgnuspool.hosts\fR\|(5),
\&\fIgspl\-cjlist\fR\|(8),
\&\fIgspl\-cplist\fR\|(8),
\&\fIdosspwrite\fR\|(8),
\&\fIripc\fR\|(8),
\&\fIspd\fR\|(8),
\&\fIspdinit\fR\|(8),
\&\fIspmdisp\fR\|(8),
\&\fIspwrite\fR\|(8),
\&\fIgspl\-spuconv\fR\|(8),
\&\fIxtnetserv\fR\|(8).
.SH "DIAGNOSTICS"
.IX Header "DIAGNOSTICS"
\&\fBspshed\fR is invoked from system startup procedures or other programs
such as \fIgspl\-start\fR\|(1). Thereafter it runs as a \*(L"daemon process\*(R" and
diagnostics are not written to any terminal but to the file
\&\fIspshed_reps\fR.
.PP
In the event of any problems this file should be examined.
.SH "AUTHOR"
.IX Header "AUTHOR"
John M Collins, Xi Software Ltd.
