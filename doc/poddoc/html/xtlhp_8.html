<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>xtlhp - hpnpf protocol server driver</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->
<!--

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#options">OPTIONS</a></li>
	<li><a href="#configuration_file">CONFIGURATION FILE</a></li>
	<li><a href="#control_file_format">CONTROL FILE FORMAT</a></li>
	<ul>

		<li><a href="#expressions">Expressions</a></li>
		<li><a href="#constructs">Constructs</a></li>
		<li><a href="#example">EXAMPLE</a></li>
	</ul>

	<li><a href="#diagnostics">DIAGNOSTICS</a></li>
	<li><a href="#exit_codes">EXIT CODES</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#author">AUTHOR</a></li>
</ul>
-->
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>xtlhp - hpnpf protocol server driver</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p><strong>xtlhp</strong>
<em>-h hostname</em>
<em>-p port</em>
[ <em>-d n</em> ]
[ <em>-f file</em> ]
[ <em>-c file</em> ]
[ <em>-l log</em> ]
[ <em>-b blksize</em> ]
[ <em>-c community</em> ]
[ <em>-T timeout</em> ]
[ <em>-S snmp</em> ]
[ <em>-D n</em> ]</p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p><strong>xtlhp</strong> is a terminal server program for use by <strong>GNUspool</strong> where
the destination is an HPNPF server. Alternatively other printer
devices which accept input using ``reverse telnet'' and allow status to
be interrogated via SNMP (or other means) may be driven.</p>
<p>After each block is transmitted, the status of the printer is
interrogated using a supplied control script.</p>
<p>Versions of <strong>xtlhp</strong> after 23.6 perform SNMP operations directly, rather
than relying on an external program being available.</p>
<p>
</p>
<hr />
<h1><a name="options">OPTIONS</a></h1>
<dl>
<dt><strong><a name="item__2dh_hostname">-h <em>hostname</em></a></strong>

<dd>
<p>This is the host name or IP address to be used to access the
printer. In <strong>GNUspool</strong> setup files, it may be appropriate to
substitute <code>$SPOOLDEV</code> or <code>$SPOOLPTR</code> here.</p>
</dd>
</li>
<dt><strong><a name="item__2dp_port_number">-p <em>port number</em></a></strong>

<dd>
<p>This is the port number or service port name to be used.</p>
</dd>
</li>
<dt><strong><a name="item__2df_configname">-f <em>configname</em></a></strong>

<dd>
<p>This is the location of the definitions file, if not <em>xtsnmpdef</em> in
the <strong>GNUspool</strong> internal programs directory.</p>
</dd>
</li>
<dt><strong><a name="item__2dc_file">-c <em>file</em></a></strong>

<dd>
<p>Specifies a control file for obtaining the printer status. See the
CONTROL FILE section below.</p>
</dd>
</li>
<dt><strong><a name="item__2dl_logfile">-l <em>logfile</em></a></strong>

<dd>
<p>Specify error message destination if not standard error.</p>
</dd>
</li>
<dt><strong><a name="item__2db_n">-b <em>n</em></a></strong>

<dd>
<p>Specify output block size. <em>n</em> may be a number, or followed by <strong>b</strong>,
<strong>k</strong>, <strong>m</strong> or <strong>g</strong> to denote blocks, kilobytes, megabytes or
gigabytes.</p>
</dd>
<dd>
<p>Otherwise a default block size of 10K is assumed.</p>
</dd>
</li>
<dt><strong><a name="item__2dd_n">-d <em>n</em></a></strong>

<dd>
<p>Debug. Displays activities on standard error, if <em>n</em> is greater than
zero. Higher values of <em>n</em> will give more output, including tracing
of SNMP operations.</p>
</dd>
</li>
<dt><strong><a name="item__2dd_n">-D <em>n</em></a></strong>

<dd>
<p>As for <strong>-d</strong>, except that no output is attempted, the control script is
executed once only and the appropriate exit code returned. Use an
argument of zero to just invoke the script and exit.</p>
</dd>
</li>
<dt><strong><a name="item__2dc_name">-c <em>name</em></a></strong>

<dd>
<p>Specify the community in SNMP operations. The default is <strong>public</strong>.</p>
</dd>
</li>
<dt><strong><a name="item__2dt_timeout">-T <em>timeout</em></a></strong>

<dd>
<p>Specify the timeout to wait for SNMP replies. The default is 1
second, but the value given may be fractional.</p>
</dd>
</li>
<dt><strong><a name="item__2ds_snmp">-S <em>snmp</em></a></strong>

<dd>
<p>Specify the SNMP port name to use, if not <code>snmp</code>.</p>
</dd>
</li>
</dl>
<p>
</p>
<hr />
<h1><a name="configuration_file">CONFIGURATION FILE</a></h1>
<p>The configuration file <em>xtsmnpdef</em> provides a series of mnemonics for
the SNMP definition of the form:</p>
<pre>
 system 1.3.6.1.4.1.11.2
 gdStatusBytes system.3.9.1.1.1</pre>
<p>The function of these definitions is to ``macrogenerate'' constructs
which appear in the control file, for example (with appropriate definitions)
</p>
<pre>

 gdStatusPaperOut.0</pre>
<p>may be used as an abbreviation for</p>
<pre>
 1.3.6.1.4.1.11.2.3.9.1.2.8.0</pre>
<p>Previous versions of <strong>xtlhp</strong> expected quotes around the columns of
the file, but this is no longer expected. The file may define names in
terms of previously-defined names and may redefine names. If a name is
redefined, names already defined using the previous definition are
unaffected.</p>
<p>
</p>
<hr />
<h1><a name="control_file_format">CONTROL FILE FORMAT</a></h1>
<p>The control file consists of a series of command structures involving
options to obtain SNMP values, run commands, string and numeric
comparisons and assignments.</p>
<p>Constructs are based upon the shell, but control names are in
upper case.</p>
<p>
</p>
<h2><a name="expressions">Expressions</a></h2>
<dl>
<dt><strong><a name="item__27string_27">'string'</a></strong>

<dd>
<p>A single-quoted string is taken literally, as per the shell.</p>
</dd>
</li>
<dt><strong><a name="item__27_27string_27_27">''string''</a></strong>

<dd>
<p>A string enclosed in double-quote characters is subject to name
expansions of macros defined in the configuration file and variables
assigned in the script.</p>
</dd>
</li>
<dt><strong><a name="item_snmpvar"><code>SNMPVAR(objid)</code></a></strong>

<dd>
<p>The specified <em>objid</em>, which may be specified using macros, is
returned, treated as a numeric value.</p>
</dd>
</li>
<dt><strong><a name="item_snmpstr"><code>SNMPSTR(objid)</code></a></strong>

<dd>
<p>The specified <em>objid</em>, which may be specified using macros, is
returned, treated as a string value.</p>
</dd>
</li>
<dt><strong><a name="item__60string_60">`string`</a></strong>

<dd>
<p>A back-quoted string is a shell command to execute and the output taken as a
string. Variable names are expanded within the string before execution.</p>
</dd>
</li>
<dt><strong><a name="item__5bstring_5d">[string]</a></strong>

<dd>
<p>A string enclosed in square brackets is a shell command to execute,
with the output taken to be a decimal numeric value, the whole
returning a numeric value. Variable names are expanded within the
string before execution.</p>
</dd>
</li>
<dt><strong><a name="item__7bstring_7d">{string}</a></strong>

<dd>
<p>A string enclosed in braces is a shell command to execute, with the
output assumed to be a hexadecimal value. (This is required for
<code>snmpinfo(8)</code> on AIX systems, which returns hexadecimal values).
Variable names are expanded within the string before execution.</p>
</dd>
</li>
<dt><strong><a name="item_number"><em>number</em></a></strong>

<dd>
<p>a numeric value.</p>
</dd>
</li>
<dt><strong><a name="item_name"><em>name</em></a></strong>

<dd>
<p>The value currently assigned to <em>name</em>, if any, is the value of the
expression.</p>
</dd>
</li>
<dt><strong><a name="item_lastval">LASTVAL</a></strong>

<dd>
<p>The last SNMP value obtained (possibly using <a href="#item_defined"><code>DEFINED</code></a> or
<a href="#item_undefined"><code>UNDEFINED</code></a>) as a numeric or string value.</p>
</dd>
</li>
</dl>
<p>
</p>
<h2><a name="constructs">Constructs</a></h2>
<p>The following constructs or ``statements'' are used in the control file.</p>
<dl>
<dt><strong><a name="item__3d">=</a></strong>

<dd>
<p>Assignment, as in</p>
</dd>
<dd>
<pre>
 X = &quot;ABC&quot;</pre>
</dd>
<dd>
<p>The value on the right is assigned to the name on the left.</p>
</dd>
</li>
<dt><strong><a name="item__3a_3d">:=</a></strong>

<dd>
<p>One time assignment. As per assignment, but the operation is turned into a no-op after the
first execution.</p>
</dd>
<dd>
<p>For example</p>
</dd>
<dd>
<pre>
 Host = `hostname`</pre>
</dd>
<dd>
<p>would be evaluated each time the script is run (after every block),
but</p>
</dd>
<dd>
<pre>
 Host := `hostname`</pre>
</dd>
<dd>
<p>would only be evaluated the first time.</p>
</dd>
</li>
<dt><strong><a name="item_comparison"><em>comparison</em></a></strong>

<dd>
<p>Comparison of strings is performed with alphabetic operators <strong>LT</strong>,
<strong>LE</strong>, <strong>EQ</strong>, <strong>NE</strong>, <strong>GE</strong> and <strong>GT</strong>, and numerics with symbolic
operators <strong>&lt;</strong> etc.</p>
</dd>
</li>
<dt><strong><a name="item_defined"><code>DEFINED(objid)</code></a></strong>

<dd>
<p>Return a true value if the given object id (which may be specified
using macros) is defined, otherwise false. If the value is defined,
<strong>LASTVAL</strong> is set to whatever value that was to save further fetches.</p>
</dd>
</li>
<dt><strong><a name="item_undefined"><code>UNDEFINED(objid)</code></a></strong>

<dd>
<p>As for <strong>DEFINED</strong> but the other truth value is returned. <strong>LASTVAL</strong> is
still set if the value is defined.</p>
</dd>
</li>
<dt><strong><a name="item_isnum_value">ISNUM <em>value</em></a></strong>

<dd>
<p>Return a true value if the value is a number.</p>
</dd>
</li>
<dt><strong><a name="item_isstring_value">ISSTRING <em>value</em></a></strong>

<dd>
<p>Return a true value if the value is a string.</p>
</dd>
</li>
<dt><strong><a name="item_and_or__22_26_26_22__22_7c_7c_22">AND OR ``&amp;&amp;'' ``||''</a></strong>

<dd>
<p>Combine boolean operations in tests. <strong>AND</strong> is more binding than
<strong>OR</strong>. ``Short circuit'' evaluation is performed, so beware of relying
on <strong>LASTVAL</strong>.</p>
</dd>
</li>
<dt><strong><a name="item_if__2e_2e_then__2e_2e__5belif__2e_2e_then__5d__5be">IF .. THEN .. [ELIF .. THEN ] [ELSE .. ] FI</a></strong>

<dd>
<p>Conditional construct with optional <strong>ELIF</strong> and <strong>ELSE</strong> parts.</p>
</dd>
</li>
<dt><strong><a name="item_msg_string">MSG <em>STRING</em></a></strong>

<dd>
<p>Display message on standard error.</p>
</dd>
</li>
<dt><strong><a name="item_exit_number">EXIT <em>number</em></a></strong>

<dd>
<p>Exit <strong>xtlhp</strong> with specified exit code (from 0 to 255).</p>
</dd>
</li>
<dt><strong><a name="item_flush">FLUSH</a></strong>

<dd>
<p>Send flush command (ESC-E) to socket.</p>
</dd>
</li>
</dl>
<p>
</p>
<h2><a name="example">EXAMPLE</a></h2>
<p>This is the control file supplied by default, with definitions for
<code>gdStatusLineState</code> etc being provided in the definitions file
supplied.</p>
<p>Note that if no <strong>EXIT</strong> appears, then script file has ``succeeded'' and
output continues.</p>
<pre>
 # Test the status to see if there are problems</pre>
<pre>
 IF SNMPVAR(gdStatusLineState.0) != 0
 THEN
        # Look at paper out indication and exit
        # message</pre>
<pre>
        IF SNMPVAR(gdStatusPaperOut.0) != 0
        THEN
                MSG 'Out of paper'
                EXIT 100</pre>
<pre>
        # Likewise paper jam</pre>
<pre>
        ELIF SNMPVAR(gdStatusPaperJam.0) != 0
        THEN
                MSG 'Out of paper'
                EXIT 101</pre>
<pre>
        # Likewise toner low</pre>
<pre>
        ELIF SNMPVAR(gdStatusTonerLow.0) != 0
        THEN
                MSG 'Out of toner'
                EXIT 102</pre>
<pre>
        #  Give up just give general message</pre>
<pre>
        ELSE
                MSG SNMPSTR(npSysStatusMessage.0)
                EXIT 103
        FI
 FI</pre>
<p>
</p>
<hr />
<h1><a name="diagnostics">DIAGNOSTICS</a></h1>
<p><strong>xtlhp</strong> generates any appropriate diagnostics on standard error.</p>
<p>
</p>
<hr />
<h1><a name="exit_codes">EXIT CODES</a></h1>
<p>Normal termination is denoted by an exit code of zero.</p>
<p>Most of the other exit codes are determined by the control file and
can be adjusted by the user as required.</p>
<ol>
<li>
<p>Usage error, invalid option etc.</p>
</li>
<li>
<p>Device error, cannot connect socket etc.</p>
</li>
<li>
<p>System error.</p>
</li>
<li>
<p>SNMP error.</p>
</li>
</ol>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>xilp(8),
xtelnet(8),
xtftp(8),
xtlpc(8).</p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>John M Collins, Xi Software Ltd.</p>

</body>

</html>
